<% if users.empty? %>
  <p>該当するユーザーがいません</p>
<% else %>
  <table>
    <thead>
      <tr>
        <th><%= User.human_attribute_name(:image) %></th>
        <th><%= User.human_attribute_name(:username) %></th>
        <th><%= User.human_attribute_name(:introduction) %></th>
      </tr>
    </thead>

    <tbody>
      <% users.each do |user| %>
        <tr>
          <td><%= image_tag user.image, :size =>'50x50' if user.image.attached? %></td>
          <td><%= link_to user.username, user %></td>
          <td><%= user.introduction %></td>
        <% if current_user.following?(user) %>
          <td><%= form_for(current_user.active_relationships.find_by(followed_id: user.id),
                  html: { method: :delete }, remote: true) do |f| %>
              <%= f.submit "Unfollow", class: "btn" %>
              <% end %></td>
        <% else %>
          <td><%= form_for(current_user.active_relationships.build, remote: true) do |f| %>
                <div><%= hidden_field_tag :followed_id, user.id %></div>
                <%= f.submit "Follow", class: "btn" %>
              <% end %></td>
      <% end %>
      </tr><% end %>
    </tbody>
  </table>
<% end %>
